name: 'XRPL Hooks Analyzer'
author: 'tequ'
description: 'Analyze XRPL hook deploy fee, execution fee'
inputs:
  inPath:
    description: 'directory of c files'
    required: true
runs:
  using: "composite"
  steps:
    - name: Install Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
    - name: Install Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.9'
    - name: Install XRPLD Netgen
      shell: bash
      run: |
        pip install xrpld-netgen
    - name: Run XRPLD
      shell: bash
      run: |
        npm run xrpld:start
    - name: Run Analyzer
      id: analyzer_step
      shell: bash
      run: |
        node $GITHUB_ACTION_PATH/dist/index.js
      env:
        GITHUB_ACTION_PATH: ${{ github.action_path }}
        IN_PATH: ${{ inputs.inPath }}
        
    - name: Pull Request Comment
      if: github.event_name == 'pull_request'
      uses: actions/github-script@v7
      env:
        SUMMARY: ${{ steps.analyzer_step.outputs.summary }}
      with:
        script: |
          await github.rest.issues.createComment({
            issue_number: context.issue.number,
            owner: context.repo.owner,
            repo: context.repo.repo,
            body: process.env.SUMMARY
          })

